name: Create Tag

env:
  NODE_VERSION: 20.x # è®¾ç½® Node.js ç‰ˆæœ¬ç¯å¢ƒå˜é‡

on:
  push:
    branches:
      - main

jobs:
  # =====================
  # Job 1: è‡ªåŠ¨åŒ–è¯­ä¹‰åŒ–ç‰ˆæœ¬å‘å¸ƒï¼ˆç”Ÿæˆç‰ˆæœ¬å·ã€æ‰“ tagã€æ›´æ–° CHANGELOGï¼‰
  # =====================
  release:
    name: ğŸš€ Semantic ç‰ˆæœ¬å‘å¸ƒ
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write

    # è·³è¿‡ CI çš„æäº¤
    if: "!contains(github.event.head_commit.message, 'skip ci')"

    outputs:
      new_release_published: ${{ steps.release.outputs.new_release_published }}
      new_release_version: ${{ steps.release.outputs.new_release_version }}
      current_tag: ${{ steps.release.outputs.current_tag }}
      previous_tag: ${{ steps.release.outputs.previous_tag }}
      changelog_preview: ${{ steps.release.outputs.changelog_preview }}

    steps:
      - name: ğŸ” 1. æ‹‰å–ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # å¿…é¡»å®Œæ•´å†å²ä»¥æ”¯æŒ semantic-release åˆ¤æ–­å˜æ›´

      - name: âš™ï¸ 2. è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ 3. å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ“¢ 4. æ‰§è¡Œ semantic-release
        id: release
        env:
          GITHUB_TOKEN: ${{ secrets.MY_PERSONAL_TOKEN }}
        run: npx semantic-release --debug
